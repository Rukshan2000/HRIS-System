import React, { useState, useEffect } from 'react';
import axios from 'axios';
import * as XLSX from 'xlsx';

const EmployeeReport = () => {
  const [employeeData, setEmployeeData] = useState([]);

  useEffect(() => {
    fetchEmployeeData();
  }, []); // Empty dependency array to run the effect only once after initial render

  // Function to fetch employee data from the API
  const fetchEmployeeData = async () => {
    try {
      const response = await axios.get('http://localhost:8081/api/employee');
      const employee = response.data.data;
      console.log('Fetched Employee:', employee);
      setEmployeeData(employee);
    } catch (error) {
      console.error('Error fetching employee:', error);
    }
  };

  // Function to convert data to Excel file format and trigger download
  const handleDownloadExcel = () => {
    const worksheet = XLSX.utils.json_to_sheet(employeeData);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Employees');
    XLSX.writeFile(workbook, 'employee_report.xlsx');
  };

  return (
    <div className="flex flex-col items-center justify-center h-screen">
      {employeeData.length > 0 && (
        <button onClick={handleDownloadExcel} className="px-4 py-2 text-white bg-green-500 rounded-md">
          Download Excel
        </button>
      )}
    </div>
  );
};

export default EmployeeReport;
